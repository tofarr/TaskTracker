<%= form_with(model: user, local: true) do |form| %>
  <%= render partial: "partials/errors", locals: {errors: user.errors} %>

  <%= render partial: "partials/form_text_field", locals: {form: form, attr: :username} %>
  <%= render partial: "partials/form_text_field", locals: {form: form, attr: :name} %>
  <%= render partial: "partials/form_text_field", locals: {form: form, attr: :email} %>
  <%= render partial: "partials/form_img", locals: {form: form, attr: :avatar, img: user.avatar, size: 48} %>

  <div class="field level">
    <%= form.label :admin, class: "level-item-left column is-one-quarter" %>
    <div class="level-item-left column is-three-quaters">
      <%= form.check_box :admin, :disabled => user.id == @current_user.id  %>
    </div>
  </div>

  <div class="field level">
    <%= form.label :suspended, class: "level-item-left column is-one-quarter" %>
    <div class="level-item-left column is-three-quaters">
      <%= form.check_box :suspended, :disabled => user.id == @current_user.id %>
    </div>
  </div>

  <%= render partial: "partials/form_password", locals: {form: form, attr: :password} %>
  <%= render partial: "partials/form_password", locals: {form: form, attr: :password_confirmation} %>
  <%= render partial: "partials/form_text_field", locals: {form: form, attr: :verification_code} %>

  <div class="field level">
    <div class="level-item-left column is-one-quarter"></div>
    <div class="level-item-left column is-three-quaters">
      <fieldset class="box">
        <legend>User Tags</legend>
        <%= form.hidden_field "tag_ids[]", :value => "" %>
        <% UserTag.order(:title).each do |tag| %>
          <div class="field">
            <%= form.label tag.title %>
            <% if !@current_user.admin? && tag.only_admin_can_apply? %>
              <% if user.tags.include?(tag) %>
                <%= form.hidden_field "tag_ids[]", :value => tag.id %>
              <% end %>
              <%=user.tags.include?(tag)%>
            <% else %>
              <%= form.check_box(:tag_ids, {multiple: true, checked: user.tags.include?(tag)}, tag.id, nil) %>
            <% end %>
          </div>
        <% end %>
      </fieldset>
    </div>
  </div>

  <%= render partial: "partials/form_submit", locals: {form: form, model: user} %>

<% end %>
